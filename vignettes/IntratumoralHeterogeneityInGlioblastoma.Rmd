---
title: "Intratumoral heterogeneity in Glioblastoma"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##  Load data

We load the scRNA data of MGH106 sample from the public dataset of Gliobastoma (GSE131928)

```{r echo=TRUE, message=FALSE, warning=FALSE}
load(url("https://www.dropbox.com/s/b9udpvhnc2ez9pc/MGH106_data.RData?raw=1"))
```

## Run pipeline   

We run the pipeline that performs the classification of malignant and non-malignant cells of the MGH106 sample using 20 cores and requesting analysis of possible subpopulations.

```{r echo=TRUE, message=FALSE, warning=FALSE}

library(SCEVAN)
results <- SCEVAN::pipelineCNA(count_mtx, sample = "MGH106", par_cores = 20, SUBCLONES = TRUE, plotTree = TRUE)

```

## Output

The pipeline returns in ***results*** a data frame containing for each cell its classification (tumor/normal), whether it has been used as a normal confident cell, and to which clonal subpopulation it belongs.

```{r echo=TRUE, message=FALSE, warning=FALSE}
head(results)
```

And creates an output folder containing all segmentation output files and all the plots generated by the analysis:

```{r echo=TRUE, message=FALSE, warning=FALSE}
list.files(path = "./output", pattern = "MGH106")
```

### Heatmap classification of tumor cells (heatmap.png)

Heatmap of the Copy Number Alteration matrix with classification of non-malignant and malignant cells.

<img src="./output/MGH106heatmap.png" alt="heatmap" width="1280"/>

### Heatmap of tumour cell subclones (heatmap_subclones.png)

Heatmap of the Copy Number Alteration matrix with the clonal subpopulations found.

<img src="./output/MGH106heatmap_subclones.png" alt="heatmap" width="1280"/>

### Clonal tree (CloneTree.png)

Clonal tree inferred from subsclone profiles.

<img src="./output/MGH106CloneTree.png" alt="heatmap" width="1280"/>

### Consensus plot (consensus.png)

Compact plot of the alterations present in each subpopulation.

<img src="./output/MGH106consensus.png" alt="heatmap" width="1280"/>

### OncoPrint-like plot (OncoHeat.png)

OncoPrint-like plot that highlighting specific alteration, shared alteration between subclones, or clonal alteration.

<img src="./output/MGH106OncoHeat2.png" alt="heatmap" width="1280"/>

### DE analysis in specific alterations (DEchr*_subclones.png)

Vulcano plot obtained from differential expression analysis of the genes belonging to the specific alterations found.

<img src="./output/MGH106-DEchr1-155320896-160358952_subclones.png" alt="heatmap" width="720"/>

<img src="./output/MGH106-DEchr12-109088188-120904371_subclones.png" alt="heatmap" width="720"/>

### Pathway Analysis of subclones (pathwayAnalysis_subclones*.png)

REACTOME pathways activity obtained with GSEA for each subclone in contrast to the others for each subclone.

<img src="./output/MGH106pathwayAnalysis_subclones1.png" alt="heatmap" width="1280"/>
<img src="./output/MGH106pathwayAnalysis_subclones2.png" alt="heatmap" width="1280"/>
<img src="./output/MGH106pathwayAnalysis_subclones3.png" alt="heatmap" width="1280"/>